<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>2048 in Python - Donnacha Oisín Kidney</title>
        <style>body{color:black;font-family:Garamond,Times New Roman,serif;font-size:14px;margin:0px auto 0px auto;padding-left:5px;padding-right:5px;max-width:600px}math{font-size:13px}img{max-width:600px}div#header{border-bottom:3px double black;margin-bottom:30px;padding:12px 0px 12px 0px}div#logo a{color:black;float:left;font-size:20px;text-decoration:none}div#header #navigation{text-align:right}div#header #navigation a{color:black;font-family:Garamond,Times New Roman,Serif;font-size:18px;margin-left:10px;text-decoration:none;text-transform:uppercase}div#footer{font-family:Garamond,Times New Roman,Serif;border-top:solid 2px black;color:#555;font-size:12px;margin-top:30px;padding:12px 0px 12px 0px;text-align:right}h1{font-family:Garamond,Times New Roman,Serif;font-size:22px;font-weight:normal}h2{font-family:Garamond,Times New Roman,Serif;font-size:20px;font-weight:normal}div.info{color:#555;font-size:15px;font-style:italic}span.quiet{color:#828282;font-style:italic}a{color:black;word-wrap:break-word}ul.post-list{margin-left:0px;padding-left:0px;list-style-type:none}.hidden_source{display:none}ol.serieslist{counter-reset:item;list-style-type:none;padding-left:20}ol li.serieslist:before{content:'Part ' counter(item,decimal) ':';counter-increment:item}table.sourceCode,tr.sourceCode,td.lineNumbers,td.sourceCode,table.sourceCode pre{margin:0;padding:0;border:0;vertical-align:baseline;border:none}td.lineNumbers{border-right:1px solid #AAAAAA;text-align:right;color:#AAAAAA;padding-right:5px;padding-left:5px}td.sourceCode{padding-left:5px}.sourceCode,code,.Agda{font-size:10px;font-family:menlo,monospace}.sourceCode span.kw{color:#262C6A}.sourceCode span.dt{color:#476A97}.sourceCode span.dv{color:#262C6A}.sourceCode span.bn{color:#262C6A}.sourceCode span.fl{color:#262C6A}.sourceCode span.ch{color:#262C6A}.sourceCode span.st{color:#702C51}.sourceCode span.co{color:#435138}.sourceCode span.ot{color:#262C6A}.sourceCode span.al{color:red}.sourceCode span.fu{color:#000000}.sourceCode span.re{color:#000000}.sourceCode span.er{color:red}li{margin-bottom:2px}li:last-child{margin-bottom:0px}.Agda .Comment{color:#B22222}.Agda .Background{}.Agda .Markup{color:#000000}.Agda .Keyword{color:#CD6600}.Agda .String{color:#B22222}.Agda .Number{color:#A020F0}.Agda .Symbol{color:#404040}.Agda .PrimitiveType{color:#0000CD}.Agda .Pragma{color:black}.Agda .Operator{}.Agda .Bound{color:black}.Agda .Generalizable{color:black}.Agda .InductiveConstructor{color:#008B00}.Agda .CoinductiveConstructor{color:#8B7500}.Agda .Datatype{color:#0000CD}.Agda .Field{color:#EE1289}.Agda .Function{color:#0000CD}.Agda .Module{color:#A020F0}.Agda .Postulate{color:#0000CD}.Agda .Primitive{color:#0000CD}.Agda .Record{color:#0000CD}.Agda .DottedPattern{}.Agda .UnsolvedMeta{color:black;background:yellow}.Agda .UnsolvedConstraint{color:black;background:yellow}.Agda .TerminationProblem{color:black;background:#FFA07A}.Agda .IncompletePattern{color:black;background:#F5DEB3}.Agda .Error{color:red;text-decoration:underline}.Agda .TypeChecks{color:black;background:#ADD8E6}.Agda a{text-decoration:none}.Agda a[href]:hover{background-color:#B4EEB4}.sourceCode{overflow-x:auto}</style>
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">Donnacha Oisín Kidney</a>
            </div>
            <div id="navigation">
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../rss.xml">Feed</a>
                <a href="../snippets.html">Snippets</a>
            </div>
        </div>

        <div id="content">
            <h2>2048 in Python</h2>

            <p>A simple implementation of the game <a href="https://gabrielecirulli.github.io/2048/">2048</a> in Python, using <a href="https://www.gnu.org/s/ncurses/">ncurses</a>.</p>
<p>It supports different “bases” (other than 2) as well as colors, and uses a kind of Python-y functional style.</p>
<p>Minus comments, the whole thing is 70 lines.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">#-----------------------------functional-helpers-------------------------#</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="im">from</span> functools <span class="im">import</span> <span class="bu">reduce</span>, partial</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw">def</span> compose(<span class="op">*</span>funcs):</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  <span class="co">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">  Mathematical function composition.</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">  compose(h, g, f)(x) =&gt; h(g(f(x)))</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">  &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">  <span class="cf">return</span> <span class="bu">reduce</span>(<span class="kw">lambda</span> a,e: <span class="kw">lambda</span> x: a(e(x)), funcs, <span class="kw">lambda</span> x: x)</a>
<a class="sourceLine" id="cb1-13" data-line-number="13"></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#-----------------------------------base---------------------------------#</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co"># The base determines three things:</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#  - The number of squares which need to be in a row to coalesce (= base)</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co">#  - The length of the side of the board (= base^2)</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="co">#  - The number added to a random blank box on the board at the beginning</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="co">#    of every turn. (The seed) (90% of the time, the number added will be</span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="co">#    the base, but 10% of the time, it will be the square of the base)</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="co">#  - The number of seeds added at evey turn (= 2^(base - 2))</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="co">#</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="co"># Normal 2048 has a base of 2.</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"></a>
<a class="sourceLine" id="cb1-26" data-line-number="26">base <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">&quot;Choose a base. (2 for normal 2048)</span><span class="ch">\n</span><span class="st">&gt; &quot;</span>))</a>
<a class="sourceLine" id="cb1-27" data-line-number="27"></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="co">#-----------------------------------rand---------------------------------#</span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"></a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="kw">def</span> addn(board):</a>
<a class="sourceLine" id="cb1-31" data-line-number="31"></a>
<a class="sourceLine" id="cb1-32" data-line-number="32">  <span class="co">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-33" data-line-number="33"><span class="co">  Inserts n seeds into random, empty positions in board. Returns board.</span></a>
<a class="sourceLine" id="cb1-34" data-line-number="34"><span class="co">  n = 2^(base - 2)</span></a>
<a class="sourceLine" id="cb1-35" data-line-number="35"><span class="co">  The  seed is equal to base 90% of the time. 10% of the time, it is</span></a>
<a class="sourceLine" id="cb1-36" data-line-number="36"><span class="co">  equal to the square of the base.</span></a>
<a class="sourceLine" id="cb1-37" data-line-number="37"><span class="co">  &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-38" data-line-number="38"></a>
<a class="sourceLine" id="cb1-39" data-line-number="39">  <span class="im">from</span> random <span class="im">import</span> randrange, sample</a>
<a class="sourceLine" id="cb1-40" data-line-number="40"></a>
<a class="sourceLine" id="cb1-41" data-line-number="41">  inds    <span class="op">=</span> <span class="bu">range</span>(base<span class="op">**</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1-42" data-line-number="42">  empties <span class="op">=</span> [(y,x) <span class="cf">for</span> y <span class="kw">in</span> inds <span class="cf">for</span> x <span class="kw">in</span> inds <span class="cf">if</span> <span class="kw">not</span> board[y][x]]</a>
<a class="sourceLine" id="cb1-43" data-line-number="43">  <span class="cf">for</span> y,x <span class="kw">in</span> sample(empties,<span class="dv">2</span><span class="op">**</span>(base<span class="dv">-2</span>)):</a>
<a class="sourceLine" id="cb1-44" data-line-number="44">    board[y][x] <span class="op">=</span> base <span class="cf">if</span> randrange(<span class="dv">10</span>) <span class="cf">else</span> base<span class="op">**</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb1-45" data-line-number="45">  <span class="cf">return</span> board</a>
<a class="sourceLine" id="cb1-46" data-line-number="46"></a>
<a class="sourceLine" id="cb1-47" data-line-number="47"><span class="co">#----------------------------------squish--------------------------------#</span></a>
<a class="sourceLine" id="cb1-48" data-line-number="48"></a>
<a class="sourceLine" id="cb1-49" data-line-number="49"><span class="im">from</span> itertools <span class="im">import</span> count, groupby, starmap</a>
<a class="sourceLine" id="cb1-50" data-line-number="50"></a>
<a class="sourceLine" id="cb1-51" data-line-number="51"><span class="kw">def</span> squish(row):</a>
<a class="sourceLine" id="cb1-52" data-line-number="52"></a>
<a class="sourceLine" id="cb1-53" data-line-number="53">  <span class="co">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-54" data-line-number="54"><span class="co">  Returns a list, the same length as row, with the contents</span></a>
<a class="sourceLine" id="cb1-55" data-line-number="55"><span class="co">  &quot;squished&quot; by the rules of 2048.</span></a>
<a class="sourceLine" id="cb1-56" data-line-number="56"><span class="co">  Boxes are coalesced by adding their values together.</span></a>
<a class="sourceLine" id="cb1-57" data-line-number="57"><span class="co">  Boxes will be coalesced iff:</span></a>
<a class="sourceLine" id="cb1-58" data-line-number="58"><span class="co">   - They are adjacent, or there are only empty boxes between them.</span></a>
<a class="sourceLine" id="cb1-59" data-line-number="59"><span class="co">   - The total number of boxes is equal to the base.</span></a>
<a class="sourceLine" id="cb1-60" data-line-number="60"><span class="co">   - All the values of the boxes are equal.</span></a>
<a class="sourceLine" id="cb1-61" data-line-number="61"><span class="co">  For base 2:</span></a>
<a class="sourceLine" id="cb1-62" data-line-number="62"><span class="co">  [2][2][ ][ ] -&gt; [4][ ][ ][ ]</span></a>
<a class="sourceLine" id="cb1-63" data-line-number="63"><span class="co">  [2][2][2][2] -&gt; [4][4][ ][ ]</span></a>
<a class="sourceLine" id="cb1-64" data-line-number="64"><span class="co">  [4][ ][4][2] -&gt; [8][2][ ][ ]</span></a>
<a class="sourceLine" id="cb1-65" data-line-number="65"><span class="co">  [4][2][4][2] -&gt; [4][2][4][2]</span></a>
<a class="sourceLine" id="cb1-66" data-line-number="66"><span class="co">  For base 3:</span></a>
<a class="sourceLine" id="cb1-67" data-line-number="67"><span class="co">  [3][ ][ ][3][ ][ ][3][ ][ ] -&gt; [9][ ][ ][ ][ ][ ][ ][ ][ ]</span></a>
<a class="sourceLine" id="cb1-68" data-line-number="68"><span class="co">  [3][3][3][3][3][3][3][3][3] -&gt; [9][9][9][ ][ ][ ][ ][ ][ ]</span></a>
<a class="sourceLine" id="cb1-69" data-line-number="69"><span class="co">  [3][3][3][9][9][ ][ ][ ][ ] -&gt; [9][9][9][ ][ ][ ][ ][ ][ ]</span></a>
<a class="sourceLine" id="cb1-70" data-line-number="70"><span class="co">  Keyword arguments:</span></a>
<a class="sourceLine" id="cb1-71" data-line-number="71"><span class="co">  row -- A list, containing a combination of numbers and None</span></a>
<a class="sourceLine" id="cb1-72" data-line-number="72"><span class="co">  (representing empty boxes)</span></a>
<a class="sourceLine" id="cb1-73" data-line-number="73"><span class="co">  &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-74" data-line-number="74"></a>
<a class="sourceLine" id="cb1-75" data-line-number="75">  r <span class="op">=</span> []</a>
<a class="sourceLine" id="cb1-76" data-line-number="76">  <span class="cf">for</span> n,x <span class="kw">in</span> starmap(<span class="kw">lambda</span> n, a: (n, <span class="bu">sum</span>(<span class="bu">map</span>(<span class="bu">bool</span>,a))),</a>
<a class="sourceLine" id="cb1-77" data-line-number="77">                     groupby(<span class="bu">filter</span>(<span class="bu">bool</span>, row))):</a>
<a class="sourceLine" id="cb1-78" data-line-number="78">    r <span class="op">+=</span> ([n<span class="op">*</span>base] <span class="op">*</span> (x<span class="op">//</span>base)) <span class="op">+</span> ([n] <span class="op">*</span> (x<span class="op">%</span>base))</a>
<a class="sourceLine" id="cb1-79" data-line-number="79">  <span class="cf">return</span> r <span class="op">+</span> ([<span class="va">None</span>] <span class="op">*</span> (base<span class="op">**</span><span class="dv">2</span> <span class="op">-</span> <span class="bu">len</span>(r)))</a>
<a class="sourceLine" id="cb1-80" data-line-number="80"></a>
<a class="sourceLine" id="cb1-81" data-line-number="81"><span class="co">#----------------------------matrix-manipulation-------------------------#</span></a>
<a class="sourceLine" id="cb1-82" data-line-number="82"></a>
<a class="sourceLine" id="cb1-83" data-line-number="83"><span class="co"># Transposes an iterable of iterables</span></a>
<a class="sourceLine" id="cb1-84" data-line-number="84"><span class="co"># [[1, 2], -&gt; [[1, 3],</span></a>
<a class="sourceLine" id="cb1-85" data-line-number="85"><span class="co">#  [3, 4]]     [2, 4]]</span></a>
<a class="sourceLine" id="cb1-86" data-line-number="86"></a>
<a class="sourceLine" id="cb1-87" data-line-number="87"><span class="kw">def</span> transpose(l): <span class="cf">return</span> [<span class="bu">list</span>(x) <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">zip</span>(<span class="op">*</span>l)]</a>
<a class="sourceLine" id="cb1-88" data-line-number="88"></a>
<a class="sourceLine" id="cb1-89" data-line-number="89"><span class="co"># Flips horizontally an iterable of lists</span></a>
<a class="sourceLine" id="cb1-90" data-line-number="90"><span class="co"># [[1, 2], -&gt; [[2, 1],</span></a>
<a class="sourceLine" id="cb1-91" data-line-number="91"><span class="co">#  [3, 4]]     [4, 3]]</span></a>
<a class="sourceLine" id="cb1-92" data-line-number="92"></a>
<a class="sourceLine" id="cb1-93" data-line-number="93">flip <span class="op">=</span> partial(<span class="bu">map</span>, <span class="bu">reversed</span>)</a>
<a class="sourceLine" id="cb1-94" data-line-number="94"></a>
<a class="sourceLine" id="cb1-95" data-line-number="95"><span class="co"># transforms an iterable of iterables into a list of lists</span></a>
<a class="sourceLine" id="cb1-96" data-line-number="96"></a>
<a class="sourceLine" id="cb1-97" data-line-number="97">thunk <span class="op">=</span> compose(<span class="bu">list</span>, partial(<span class="bu">map</span>, <span class="bu">list</span>))</a>
<a class="sourceLine" id="cb1-98" data-line-number="98"></a>
<a class="sourceLine" id="cb1-99" data-line-number="99"><span class="co">#----------------------------------moves---------------------------------#</span></a>
<a class="sourceLine" id="cb1-100" data-line-number="100"></a>
<a class="sourceLine" id="cb1-101" data-line-number="101"><span class="co"># The move functions take a board as their argument, and return the board</span></a>
<a class="sourceLine" id="cb1-102" data-line-number="102"><span class="co"># &quot;squished&quot; in a given direction.</span></a>
<a class="sourceLine" id="cb1-103" data-line-number="103"></a>
<a class="sourceLine" id="cb1-104" data-line-number="104">moveLeft  <span class="op">=</span> compose(thunk, partial(<span class="bu">map</span>, squish), thunk)</a>
<a class="sourceLine" id="cb1-105" data-line-number="105">moveRight <span class="op">=</span> compose(thunk, flip, moveLeft, flip)</a>
<a class="sourceLine" id="cb1-106" data-line-number="106">moveUp    <span class="op">=</span> compose(transpose, moveLeft, transpose)</a>
<a class="sourceLine" id="cb1-107" data-line-number="107">moveDown  <span class="op">=</span> compose(transpose, moveRight, transpose)</a>
<a class="sourceLine" id="cb1-108" data-line-number="108"></a>
<a class="sourceLine" id="cb1-109" data-line-number="109"><span class="co">#-------------------------------curses-init------------------------------#</span></a>
<a class="sourceLine" id="cb1-110" data-line-number="110"><span class="cf">try</span>:</a>
<a class="sourceLine" id="cb1-111" data-line-number="111">    <span class="im">import</span> curses</a>
<a class="sourceLine" id="cb1-112" data-line-number="112"></a>
<a class="sourceLine" id="cb1-113" data-line-number="113">    screen <span class="op">=</span> curses.initscr()</a>
<a class="sourceLine" id="cb1-114" data-line-number="114">    curses.noecho()           <span class="co"># Don't print pressed keys</span></a>
<a class="sourceLine" id="cb1-115" data-line-number="115">    curses.cbreak()           <span class="co"># Don't wait for enter</span></a>
<a class="sourceLine" id="cb1-116" data-line-number="116">    screen.keypad(<span class="va">True</span>)</a>
<a class="sourceLine" id="cb1-117" data-line-number="117">    curses.curs_set(<span class="va">False</span>)    <span class="co"># Hide cursor</span></a>
<a class="sourceLine" id="cb1-118" data-line-number="118"></a>
<a class="sourceLine" id="cb1-119" data-line-number="119"><span class="co">#----------------------------------keymap--------------------------------#</span></a>
<a class="sourceLine" id="cb1-120" data-line-number="120"></a>
<a class="sourceLine" id="cb1-121" data-line-number="121">    <span class="co"># A map from the arrow keys to the movement functions</span></a>
<a class="sourceLine" id="cb1-122" data-line-number="122"></a>
<a class="sourceLine" id="cb1-123" data-line-number="123">    moves <span class="op">=</span> {curses.KEY_RIGHT: moveRight,</a>
<a class="sourceLine" id="cb1-124" data-line-number="124">            curses.KEY_LEFT : moveLeft ,</a>
<a class="sourceLine" id="cb1-125" data-line-number="125">            curses.KEY_UP   : moveUp   ,</a>
<a class="sourceLine" id="cb1-126" data-line-number="126">            curses.KEY_DOWN : moveDown }</a>
<a class="sourceLine" id="cb1-127" data-line-number="127"></a>
<a class="sourceLine" id="cb1-128" data-line-number="128"><span class="co">#----------------------------------color---------------------------------#</span></a>
<a class="sourceLine" id="cb1-129" data-line-number="129"></a>
<a class="sourceLine" id="cb1-130" data-line-number="130">    curses.start_color()</a>
<a class="sourceLine" id="cb1-131" data-line-number="131">    curses.use_default_colors()</a>
<a class="sourceLine" id="cb1-132" data-line-number="132">    curses.init_pair(<span class="dv">1</span>, curses.COLOR_WHITE, <span class="dv">-1</span>) <span class="co"># Border color</span></a>
<a class="sourceLine" id="cb1-133" data-line-number="133"></a>
<a class="sourceLine" id="cb1-134" data-line-number="134">    <span class="kw">def</span> colorfac():</a>
<a class="sourceLine" id="cb1-135" data-line-number="135"></a>
<a class="sourceLine" id="cb1-136" data-line-number="136">        <span class="co">&quot;&quot;&quot;Initializes a color pair and returns it (skips black)&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-137" data-line-number="137"></a>
<a class="sourceLine" id="cb1-138" data-line-number="138">        <span class="cf">for</span> i,c <span class="kw">in</span> <span class="bu">zip</span>(count(<span class="dv">2</span>),(c <span class="cf">for</span> c <span class="kw">in</span> count(<span class="dv">1</span>) <span class="cf">if</span> c<span class="op">!=</span>curses.COLOR_BLACK)):</a>
<a class="sourceLine" id="cb1-139" data-line-number="139">            curses.init_pair(i, c, <span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb1-140" data-line-number="140">            <span class="cf">yield</span> curses.color_pair(i)</a>
<a class="sourceLine" id="cb1-141" data-line-number="141"></a>
<a class="sourceLine" id="cb1-142" data-line-number="142">    colorgen <span class="op">=</span> colorfac()</a>
<a class="sourceLine" id="cb1-143" data-line-number="143"></a>
<a class="sourceLine" id="cb1-144" data-line-number="144">    <span class="im">from</span> collections <span class="im">import</span> defaultdict</a>
<a class="sourceLine" id="cb1-145" data-line-number="145"></a>
<a class="sourceLine" id="cb1-146" data-line-number="146">    <span class="co"># A cache of colors, with the keys corresponding to numbers on the board.</span></a>
<a class="sourceLine" id="cb1-147" data-line-number="147"></a>
<a class="sourceLine" id="cb1-148" data-line-number="148">    colors <span class="op">=</span> defaultdict(<span class="kw">lambda</span>: <span class="bu">next</span>(colorgen))</a>
<a class="sourceLine" id="cb1-149" data-line-number="149"></a>
<a class="sourceLine" id="cb1-150" data-line-number="150"><span class="co">#---------------------------printing-the-board---------------------------#</span></a>
<a class="sourceLine" id="cb1-151" data-line-number="151"></a>
<a class="sourceLine" id="cb1-152" data-line-number="152">    size <span class="op">=</span> <span class="bu">max</span>(<span class="dv">11</span> <span class="op">-</span> base<span class="op">*</span><span class="dv">2</span>, <span class="dv">3</span>) <span class="co"># box width</span></a>
<a class="sourceLine" id="cb1-153" data-line-number="153"></a>
<a class="sourceLine" id="cb1-154" data-line-number="154">    <span class="kw">def</span> printBoard(board):</a>
<a class="sourceLine" id="cb1-155" data-line-number="155"></a>
<a class="sourceLine" id="cb1-156" data-line-number="156">        <span class="kw">def</span> line(b,c): <span class="cf">return</span> b <span class="op">+</span> b.join([c<span class="op">*</span>(size)]<span class="op">*</span><span class="bu">len</span>(board)) <span class="op">+</span> b</a>
<a class="sourceLine" id="cb1-157" data-line-number="157">        border, gap <span class="op">=</span> line(<span class="st">&quot;+&quot;</span>,<span class="st">&quot;-&quot;</span>), line(<span class="st">&quot;|&quot;</span>,<span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb1-158" data-line-number="158">        pad <span class="op">=</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join([gap]<span class="op">*</span>((size<span class="dv">-2</span>)<span class="op">//</span><span class="dv">4</span>)) <span class="cf">if</span> size <span class="op">&gt;</span> <span class="dv">5</span> <span class="cf">else</span> <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-159" data-line-number="159">        screen.addstr(<span class="dv">0</span>, <span class="dv">0</span>, border, curses.color_pair(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb1-160" data-line-number="160">        <span class="cf">for</span> row <span class="kw">in</span> board:</a>
<a class="sourceLine" id="cb1-161" data-line-number="161">            screen.addstr(pad <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">|&quot;</span>, curses.color_pair(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb1-162" data-line-number="162">            <span class="cf">for</span> e <span class="kw">in</span> row:</a>
<a class="sourceLine" id="cb1-163" data-line-number="163">                <span class="cf">if</span> e: screen.addstr(<span class="bu">str</span>(e).center(size), colors[e])</a>
<a class="sourceLine" id="cb1-164" data-line-number="164">                <span class="cf">else</span>: screen.addstr(<span class="st">&quot; &quot;</span> <span class="op">*</span> size)</a>
<a class="sourceLine" id="cb1-165" data-line-number="165">                screen.addstr(<span class="st">&quot;|&quot;</span>, curses.color_pair(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb1-166" data-line-number="166">            screen.addstr(pad <span class="op">+</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> <span class="op">+</span> border, curses.color_pair(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb1-167" data-line-number="167"></a>
<a class="sourceLine" id="cb1-168" data-line-number="168"><span class="co">#----------------------------------board---------------------------------#</span></a>
<a class="sourceLine" id="cb1-169" data-line-number="169"></a>
<a class="sourceLine" id="cb1-170" data-line-number="170">    <span class="co"># The board is a list of n lists, each of length n, where n is the base</span></a>
<a class="sourceLine" id="cb1-171" data-line-number="171">    <span class="co"># squared. Empty boxes are represented by None. The starting board has</span></a>
<a class="sourceLine" id="cb1-172" data-line-number="172">    <span class="co"># one seed.</span></a>
<a class="sourceLine" id="cb1-173" data-line-number="173">    board <span class="op">=</span> addn([[<span class="va">None</span> <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(base<span class="op">**</span><span class="dv">2</span>)] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(base<span class="op">**</span><span class="dv">2</span>)])</a>
<a class="sourceLine" id="cb1-174" data-line-number="174">    printBoard(board)</a>
<a class="sourceLine" id="cb1-175" data-line-number="175"></a>
<a class="sourceLine" id="cb1-176" data-line-number="176"><span class="co">#----------------------------------game-loop-----------------------------#</span></a>
<a class="sourceLine" id="cb1-177" data-line-number="177">    <span class="co"># The main game loop. Continues until there are not enough empty spaces</span></a>
<a class="sourceLine" id="cb1-178" data-line-number="178">    <span class="co"># on the board, or &quot;q&quot; is pressed.</span></a>
<a class="sourceLine" id="cb1-179" data-line-number="179"></a>
<a class="sourceLine" id="cb1-180" data-line-number="180">    <span class="cf">for</span> char <span class="kw">in</span> <span class="bu">filter</span>(moves.<span class="fu">__contains__</span>, <span class="bu">iter</span>(screen.getch, <span class="bu">ord</span>(<span class="st">&quot;q&quot;</span>))):</a>
<a class="sourceLine" id="cb1-181" data-line-number="181">        moved <span class="op">=</span> moves[char](board)</a>
<a class="sourceLine" id="cb1-182" data-line-number="182">        <span class="cf">if</span> <span class="bu">sum</span>(<span class="kw">not</span> n <span class="cf">for</span> r <span class="kw">in</span> moved <span class="cf">for</span> n <span class="kw">in</span> r) <span class="op">&lt;</span> <span class="dv">2</span><span class="op">**</span>(base<span class="dv">-2</span>): <span class="cf">break</span></a>
<a class="sourceLine" id="cb1-183" data-line-number="183">        <span class="cf">if</span> moved <span class="op">!=</span> board: board <span class="op">=</span> addn(moved)</a>
<a class="sourceLine" id="cb1-184" data-line-number="184">        printBoard(board)</a>
<a class="sourceLine" id="cb1-185" data-line-number="185"></a>
<a class="sourceLine" id="cb1-186" data-line-number="186"><span class="co">#--------------------------------clean-up--------------------------------#</span></a>
<a class="sourceLine" id="cb1-187" data-line-number="187"><span class="cf">finally</span>:</a>
<a class="sourceLine" id="cb1-188" data-line-number="188">    curses.nocbreak()     <span class="co"># Wait for enter</span></a>
<a class="sourceLine" id="cb1-189" data-line-number="189">    screen.keypad(<span class="dv">0</span>)      <span class="co"># Stop arrow-key handling</span></a>
<a class="sourceLine" id="cb1-190" data-line-number="190">    curses.echo()         <span class="co"># Print all keyboard input</span></a>
<a class="sourceLine" id="cb1-191" data-line-number="191">    curses.curs_set(<span class="va">True</span>) <span class="co"># Show cursor</span></a>
<a class="sourceLine" id="cb1-192" data-line-number="192">    curses.endwin()       <span class="co"># Return to normal prompt</span></a></code></pre></div>

        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
